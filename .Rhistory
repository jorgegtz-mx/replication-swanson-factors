#Merge both tables. Save into a spreadsheet.
query_from_yahoo_finance <- bmv_ipc_series_table %>%
full_join(mxn_futures_table, by = 'Date')
write_excel_csv(query_from_yahoo_finance, 'data/query_from_yahoo_finance.xlsx')
library(tidyverse)
library(readxl)
# (Manually) Set working directory
# Load data sets
# Load FED shock factors
fed_factors <- read_xlsx("data/pre-and-post-ZLB-factors-extended.xlsx", sheet = "Data2", skip = 1,
col_types = c("text", rep("numeric", 4)),
col_names = c("date", "ffr_shock", "fw_shock", "lsap_shock", "lsap_schock2")) %>%
mutate(Date = as.Date(date, format = "%Y-%m-%d")) %>%
#drop unformatted date column
select(-date)
# Load NAFTRAC data
naftrac <- read_xlsx("data/naftrac-daily-prices-bloomberg.xlsx",
col_types = c("date", rep("numeric", 5)),
col_names = c("date", "naftrac_close", "naftrac_open", "naftrac_high",
"naftrac_low", "cetrg028_index")) %>%
transmute(Date = as.Date(date), dlog_naftrac = log(naftrac_close) - log(naftrac_open))
# Load Mexico's treasuries data
treasuries <- read_xlsx("data/mexico-treasuries-daily-yields-since-2003.xlsx", sheet = "data",
col_types = c("date", rep("numeric", 13)),
guess_max = 4000) %>%
mutate(Fecha = as.Date(Fecha))
# Load IPC series I got from Yahoo! Finance API
bmv_ipc_yahoo <- read_csv("data/query_from_yahoo_finance.xlsx")
# Load exchange rate series
exchange_rates <- read_xlsx('data/mxn-usd-exchange-rate.xlsx', skip = 17) %>%
#format date and rename columns
transmute(Date = as.Date(paste(Year, Month, Day, sep = '-'), format = '%Y-%m-%d'),
exchange.rate.open = SF43784, exchange.rate.close = SF43786)
# Consolidate Swanson factors, treasury yields, IPC index and NAFTRAC price series into one data set.
# I will consolidate the tables separately because I need to calculate the price changes differently when the FED meeting coincides with a Mexico's National Holiday.
#First, merge "fed_factors" with "bmv_ipc_yahoo"
#The first date with market volume is May 15th 2001.
bmv_ipc_yahoo_with_volume <- bmv_ipc_yahoo %>%
filter(bmv.ipc.volume>0) %>%
transmute(Date, log.diff.bmv.ipc)
# Merge Swanson factors table with the BMV/IPC  series from Yahoo! Finance.
db <- fed_factors %>%
left_join(bmv_ipc_yahoo_with_volume, by = "Date") %>%
select(Date, everything()) %>%
#this is first date when the volume of the BMV/IPC is > 0.
filter(Date >= as.Date("2001-05-15"))
# Fill in the blanks for dates we don't have data
mexico_holidays <- (db %>%
filter(is.na(log.diff.bmv.ipc)))$Date
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays))
# Append results to merged table
db2 <- db %>%
bind_rows(fed_factors %>%
inner_join(proxy_changes_bmv_ipc_holidays, by = "Date") %>%
select(Date, everything()))
# Now I will append the NAFTRAC prices. Use the alternative method for calculating the price change
# on the Mexico's National Holidays.
proxy_changes_naftrac <- naftrac %>%
filter(Date %in% c((mx_holidays - 1), (mx_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(date_string %in% (mx_holidays + 1)) %>%
mutate(date_string = date_string - 1)
# Now I will append the NAFTRAC prices. Use the alternative method for calculating the price change
# on the Mexico's National Holidays.
proxy_changes_naftrac <- naftrac %>%
filter(Date %in% c((mexico_holidays - 1), (mexico_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(date_string %in% (mx_holidays + 1)) %>%
mutate(date_string = date_string - 1)
naftrac
naftrac <- read_xlsx("data/naftrac-daily-prices-bloomberg.xlsx",
col_types = c("date", rep("numeric", 5)),
col_names = c("date", "naftrac_close", "naftrac_open", "naftrac_high",
"naftrac_low", "cetrg028_index")) %>%
mutate(Date = as.(date))
naftrac <- read_xlsx("data/naftrac-daily-prices-bloomberg.xlsx",
col_types = c("date", rep("numeric", 5)),
col_names = c("date", "naftrac_close", "naftrac_open", "naftrac_high",
"naftrac_low", "cetrg028_index")) %>%
mutate(Date = as.Date(date))
naftrac %>%
filter(Date %in% c((mexico_holidays - 1), (mexico_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(date_string %in% (mx_holidays + 1)) %>%
mutate(date_string = date_string - 1)
naftrac %>%
filter(Date %in% c((mexico_holidays - 1), (mexico_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(Date %in% (mx_holidays + 1)) %>%
mutate(Date = Date- 1)
naftrac %>%
filter(Date %in% c((mexico_holidays - 1), (mexico_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(Date %in% (mexico_holidays + 1)) %>%
mutate(Date = Date- 1)
# Now I will append the NAFTRAC prices. Use the alternative method for calculating the price change
# on the Mexico's National Holidays.
proxy_changes_naftrac <- naftrac %>%
filter(Date %in% c((mexico_holidays - 1), (mexico_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(Date %in% (mexico_holidays + 1)) %>%
mutate(Date = Date- 1)
db3 <- db2 %>%
left_join(bind_rows(naftrac, proxy_changes_naftract) %>% arrange(Date),
by = "Date")
# Merge db2 with NAFTRAC prices
db3 <- db2 %>%
left_join(bind_rows(naftrac, proxy_changes_naftrac) %>% arrange(Date),
by = "Date")
bind_rows(naftrac, proxy_changes_naftrac) %>% arrange(Date)
bind_rows(naftrac, proxy_changes_naftrac) %>% arrange(Date)
naftrac %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac)
naftrac %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
proxy_changes_naftrac
naftrac
naftrac %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
naftrac %>% tail()
naftrac %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
naftrac %>%
filter(!is.na(naftrac_close)) %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
naftrac_clean = naftrac %>%
filter(!is.na(naftrac_close)) %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
naftrac_clean <-  naftrac %>%
filter(!is.na(naftrac_close)) %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
# Merge db2 with NAFTRAC prices
db3 <- db2 %>%
left_join(naftrac_clean, by = "Date")
db3
db3 %>%  tail()
db3
library(tidyverse)
library(readxl)
# (Manually) Set working directory
# Load data sets
# Load FED shock factors
fed_factors <- read_xlsx("data/pre-and-post-ZLB-factors-extended.xlsx", sheet = "Data2", skip = 1,
col_types = c("text", rep("numeric", 4)),
col_names = c("date", "ffr_shock", "fw_shock", "lsap_shock", "lsap_schock2")) %>%
mutate(Date = as.Date(date, format = "%Y-%m-%d")) %>%
#drop unformatted date column
select(-date)
# Load NAFTRAC data
naftrac <- read_xlsx("data/naftrac-daily-prices-bloomberg.xlsx",
col_types = c("date", rep("numeric", 5)),
col_names = c("date", "naftrac_close", "naftrac_open", "naftrac_high",
"naftrac_low", "cetrg028_index")) %>%
mutate(Date = as.Date(date))
# Load Mexico's treasuries data
treasuries <- read_xlsx("data/mexico-treasuries-daily-yields-since-2003.xlsx", sheet = "data",
col_types = c("date", rep("numeric", 13)),
guess_max = 4000) %>%
mutate(Fecha = as.Date(Fecha))
# Load IPC series I got from Yahoo! Finance API
bmv_ipc_yahoo <- read_csv("data/query_from_yahoo_finance.xlsx")
# Load exchange rate series
exchange_rates <- read_xlsx('data/mxn-usd-exchange-rate.xlsx', skip = 17) %>%
#format date and rename columns
transmute(Date = as.Date(paste(Year, Month, Day, sep = '-'), format = '%Y-%m-%d'),
exchange.rate.open = SF43784, exchange.rate.close = SF43786)
# Consolidate Swanson factors, treasury yields, IPC index and NAFTRAC price series into one data set.
# I will consolidate the tables separately because I need to calculate the price changes differently when the FED meeting coincides with a Mexico's National Holiday.
#First, merge "fed_factors" with "bmv_ipc_yahoo"
#The first date with market volume is May 15th 2001.
bmv_ipc_yahoo_with_volume <- bmv_ipc_yahoo %>%
filter(bmv.ipc.volume>0) %>%
transmute(Date, log.diff.bmv.ipc)
# Merge Swanson factors table with the BMV/IPC  series from Yahoo! Finance.
db <- fed_factors %>%
left_join(bmv_ipc_yahoo_with_volume, by = "Date") %>%
select(Date, everything()) %>%
#this is first date when the volume of the BMV/IPC is > 0.
filter(Date >= as.Date("2001-05-15"))
# Fill in the blanks for dates we don't have data
mexico_holidays <- (db %>%
filter(is.na(log.diff.bmv.ipc)))$Date
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays))
proxy_changes_bmv_ipc_holidays
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays))
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays))
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date <= mexico_holidays-2|Date>= mexico_holidays+2)
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date <= mexico_holidays-2)
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-2))
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1))
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1))
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date)
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
#fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date)
help(fill)
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up")
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date)
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up")
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
#fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up")
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "down") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date)
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date)
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays))
proxy_changes_bmv_ipc_holidays
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down")
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
filter(Date %in% (mexico_holidays-1)|Date %in% mexico_holidays|Date %in% (mexico_holidays+1)) %>%
arrange(Date)
#The first date with market volume is May 15th 2001.
bmv_ipc_yahoo_with_volume <- bmv_ipc_yahoo %>%
filter(bmv.ipc.volume>0)
# Merge Swanson factors table with the BMV/IPC  series from Yahoo! Finance.
db <- fed_factors %>%
left_join(bmv_ipc_yahoo_with_volume, by = "Date") %>%
select(Date, everything()) %>%
#this is first date when the volume of the BMV/IPC is > 0.
filter(Date >= as.Date("2001-05-15"))
# Fill in the blanks for dates we don't have data
mexico_holidays <- (db %>%
filter(is.na(log.diff.bmv.ipc)))$Date
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays))
db %>%
bind_rows(fed_factors %>%
inner_join(proxy_changes_bmv_ipc_holidays, by = "Date") %>%
select(Date, everything()))
bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays))
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays)) %>%
select(Date, bmv.ipc.open, bmv.ipc.close, log.diff.bmv.ipc)
#The first date with market volume is May 15th 2001.
bmv_ipc_yahoo_with_volume <- bmv_ipc_yahoo %>%
filter(bmv.ipc.volume>0) %>%
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open))
# Merge Swanson factors table with the BMV/IPC  series from Yahoo! Finance.
db <- fed_factors %>%
left_join(bmv_ipc_yahoo_with_volume, by = "Date") %>%
select(Date, everything()) %>%
#this is first date when the volume of the BMV/IPC is > 0.
filter(Date >= as.Date("2001-05-15"))
# Fill in the blanks for dates we don't have data
mexico_holidays <- (db %>%
filter(is.na(log.diff.bmv.ipc)))$Date
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays)) %>%
select(Date, bmv.ipc.open, bmv.ipc.close, log.diff.bmv.ipc)
proxy_changes_bmv_ipc_holidays
db2 <- db %>%
bind_rows(fed_factors %>%
inner_join(proxy_changes_bmv_ipc_holidays, by = "Date") %>%
select(Date, everything())) %>%
arrange(Date)
db2
glimpse(db2)
bmv_ipc_yahoo
glimpes(bmv_ipc_yahoo)
glimpse(bmv_ipc_yahoo)
read_csv("data/query_from_yahoo_finance.xlsx") %>%
select(-c(mxn.futures.open, mxn.futures.close, log.diff.mxn.futures))
# Load IPC series I got from Yahoo! Finance API
bmv_ipc_yahoo <- read_csv("data/query_from_yahoo_finance.xlsx") %>%
select(-c(mxn.futures.open, mxn.futures.close, log.diff.mxn.futures))
bmv_ipc_yahoo
# Load IPC series I got from Yahoo! Finance API
bmv_ipc_yahoo <- read_csv("data/query_from_yahoo_finance.xlsx") %>%
select(Date, bmv.ipc.volume, bmv.ipc.open, bmv.ipc.close)
bmv_ipc_yahoo
# Load exchange rate series
exchange_rates <- read_xlsx('data/mxn-usd-exchange-rate.xlsx', skip = 17) %>%
#format date and rename columns
transmute(Date = as.Date(paste(Year, Month, Day, sep = '-'), format = '%Y-%m-%d'),
exchange.rate.open = SF43784, exchange.rate.close = SF43786)
#The first date with market volume is May 15th 2001.
bmv_ipc_yahoo_with_volume <- bmv_ipc_yahoo %>%
filter(bmv.ipc.volume>0) %>%
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open))
# Merge Swanson factors table with the BMV/IPC  series from Yahoo! Finance.
db <- fed_factors %>%
left_join(bmv_ipc_yahoo_with_volume, by = "Date") %>%
select(Date, everything()) %>%
#this is first date when the volume of the BMV/IPC is > 0.
filter(Date >= as.Date("2001-05-15"))
db
# Fill in the blanks for dates we don't have data
mexico_holidays <- (db %>%
filter(is.na(log.diff.bmv.ipc)))$Date
proxy_changes_bmv_ipc_holidays <- bmv_ipc_yahoo %>%
filter(!is.na(bmv.ipc.open) | Date %in% c(mexico_holidays)) %>%
arrange(Date) %>%
fill(bmv.ipc.open, .direction = "up") %>%
fill(bmv.ipc.close, .direction = "down") %>%
#calculate the change between the previous close value (before the holiday) and
#the immediate next open value (when the market opens after the holiday)
mutate(log.diff.bmv.ipc = log(bmv.ipc.close)-log(bmv.ipc.open)) %>%
filter(Date %in% c(mexico_holidays)) %>%
select(Date, bmv.ipc.open, bmv.ipc.close, log.diff.bmv.ipc)
# Append results to merged table
db2 <- db %>%
bind_rows(fed_factors %>%
inner_join(proxy_changes_bmv_ipc_holidays, by = "Date") %>%
select(Date, everything())) %>%
arrange(Date)
glimpse(db2)
proxy_changes_bmv_ipc_holidays
# Now I will append the NAFTRAC prices. Use the alternative method for calculating the price change
# on the Mexico's National Holidays.
proxy_changes_naftrac <- naftrac %>%
filter(Date %in% c((mexico_holidays - 1), (mexico_holidays + 1))) %>%
arrange(Date) %>%
#Calculate the change between the last close price (the last business day before the holiday)
#and the open price after the holiday.
transmute(Date, naftrac_open, naftrac_close = lag(naftrac_close),
dlog_naftrac = log(naftrac_open) - log(naftrac_close)) %>%
filter(Date %in% (mexico_holidays + 1)) %>%
mutate(Date = Date- 1)
proxy_changes_naftrac
naftrac_clean <-  naftrac %>%
filter(!is.na(naftrac_close)) %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac) %>%
tail()
naftrac_clean <-  naftrac %>%
filter(!is.na(naftrac_close)) %>%
mutate(dlog_naftrac =  log(naftrac_open) - log(naftrac_close)) %>%
bind_rows(proxy_changes_naftrac) %>%
arrange(Date) %>%
transmute(Date, dlog_naftrac)
naftrac_clean
# Merge db2 with NAFTRAC prices
db3 <- db2 %>%
left_join(naftrac_clean, by = "Date")
naftrac_clean
naftrac_clean %>% distinct()
